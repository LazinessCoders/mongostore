name: Goreleaser

on:
  push:
    tags:
      - '*'

permissions:
  contents: write

jobs:
  goreleaser:
    runs-on: ubuntu-latest
    steps:
      -
        name: Checkout
        uses: actions/checkout@v4.1.7
        with:
          fetch-depth: 0

      -
        name: Install git-chglog
        run: |
            wget https://github.com/git-chglog/git-chglog/releases/download/v0.15.4/git-chglog_0.15.4_linux_amd64.tar.gz
            tar -xzf git-chglog_0.15.4_linux_amd64.tar.gz
            sudo mv git-chglog /usr/local/bin/

      -
        name: Generate Changelog
        run: git-chglog -c .chglog/config.yml -o CHANGELOG.md

      -
        name: Read Changelog
        id: changelog
        run: echo "changelog=$(cat CHANGELOG.md)" >> $GITHUB_OUTPUT

      - 
        name: Create Release
        uses: ncipollo/release-action@v1.14.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          body: ${{ steps.changelog.outputs.changelog }}
          draft: false
          prerelease: false